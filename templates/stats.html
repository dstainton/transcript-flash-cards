{% extends "base.html" %}

{% block title %}Statistics{% endblock %}

{% block content %}
<div class="stats-container">
    <div class="card stats-card">
        <h1>Study Statistics</h1>
        {% if current_project %}
        <div class="project-indicator">
            <strong>Project:</strong> {{ current_project.name }}
        </div>
        {% endif %}
        
        <div class="stats-section">
            <h2>Exam History</h2>
            {% if exam_history %}
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Topics</th>
                        <th>Score</th>
                        <th>Percentage</th>
                    </tr>
                </thead>
                <tbody>
                    {% for date, data in exam_history.items()|sort(reverse=true) %}
                    <tr>
                        <td>{{ date.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>{{ ', '.join(data.topics) }}</td>
                        <td>{{ data.score }}/{{ data.total }}</td>
                        <td>{{ "%.1f"|format(data.percentage) if data.percentage is defined else "N/A" }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="no-data">No exam history available</p>
            {% endif %}
        </div>

        <div class="stats-section">
            <h2>Study History</h2>
            {% if study_history %}
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Topics</th>
                        <th>Cards Completed</th>
                        <th>Success Rate</th>
                    </tr>
                </thead>
                <tbody>
                    {% for date, data in study_history.items()|sort(reverse=true) %}
                    <tr>
                        <td>{{ date.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>{{ ', '.join(data.topics) }}</td>
                        <td>{{ data.total }}</td>
                        <td>{{ "%.1f"|format(data.percentage) if data.percentage is defined else "N/A" }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="no-data">No study history available</p>
            {% endif %}
        </div>

        <div class="button-group">
            <a href="{{ url_for('start') }}" class="button" title="Start a new study or exam session">Start New Session</a>
            <a href="{{ url_for('index') }}" class="button button-secondary">Home</a>
        </div>
    </div>
</div>

<style>
.project-indicator {
    background: linear-gradient(135deg, #f0f7ff 0%, #e6f2ff 100%);
    padding: 0.8rem 1.2rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    border: 2px solid #4a90e2;
    text-align: center;
    font-size: 1.05rem;
}

.project-indicator strong {
    color: #2c3e50;
}
</style>
{% endblock %}