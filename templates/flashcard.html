{% extends "base.html" %}

{% block title %}Study Session{% endblock %}

{% block content %}
<div class="flashcard card">
    <div class="progress-info">
        <p>Card {{ session.current_card_index + 1 }} of {{ session.flashcards|length }}</p>
        <p>Score: {{ session.score }}</p>
        {% if mode == 'exam' %}
            <p>Time Remaining: <span id="timer"></span></p>
        {% endif %}
    </div>

    <div class="question">{{ card.question }}</div>
    
    <div class="answer-type-indicator">
        {% if card.answer_type == 'true_false' %}
            <span class="answer-type-badge true-false">Answer: True or False</span>
        {% elif card.answer_type == 'yes_no' %}
            <span class="answer-type-badge yes-no">Answer: Yes or No</span>
        {% elif card.answer_type == 'multiple_choice' %}
            <span class="answer-type-badge multiple-choice">Answer: Multiple Choice (Select one)</span>
        {% elif card.answer_type == 'multiple_answer' %}
            <span class="answer-type-badge multiple-answer">Answer: Multiple Answer (Select all that apply)</span>
        {% else %}
            <span class="answer-type-badge multiple-choice">Answer: Multiple Choice (Select one)</span>
        {% endif %}
    </div>

    <form method="POST" class="answer-form">
        {% if card.answer_type == 'true_false' %}
            <div class="answer-buttons">
                <button type="submit" name="answer" value="True" class="answer-button true-button">True</button>
                <button type="submit" name="answer" value="False" class="answer-button false-button">False</button>
            </div>
        {% elif card.answer_type == 'yes_no' %}
            <div class="answer-buttons">
                <button type="submit" name="answer" value="Yes" class="answer-button yes-button">Yes</button>
                <button type="submit" name="answer" value="No" class="answer-button no-button">No</button>
            </div>
        {% elif card.answer_type == 'multiple_choice' %}
            <div class="multiple-choice-options">
                {% for option in card.options %}
                <div class="option-wrapper">
                    <input type="radio" id="option_{{ loop.index }}" name="answer" value="{{ option.split(')')[0] }}" required>
                    <label for="option_{{ loop.index }}">{{ option }}</label>
                </div>
                {% endfor %}
                <button type="submit" class="button">Submit Answer</button>
            </div>
        {% elif card.answer_type == 'multiple_answer' %}
            <div class="multiple-answer-options">
                {% for option in card.options %}
                <div class="option-wrapper">
                    <input type="checkbox" id="option_{{ loop.index }}" name="answer" value="{{ option.split(')')[0] }}">
                    <label for="option_{{ loop.index }}">{{ option }}</label>
                </div>
                {% endfor %}
                <button type="submit" class="button">Submit Answer</button>
            </div>
        {% else %}
            <div class="multiple-choice-options">
                <p class="error">This question type is not supported. Please contact support.</p>
            </div>
        {% endif %}
    </form>

    {% if error %}
        <p class="error">{{ error }}</p>
    {% endif %}
    
    {% if feedback %}
        <div class="feedback-container">
            <div class="feedback {{ 'correct' if feedback.correct else 'incorrect' }}">
                <p>{{ feedback.feedback }}</p>
                {% if not feedback.correct %}
                    <p class="correct-answer-display">
                        <strong>Correct Answer:</strong> {{ feedback.correct_answer }}
                    </p>
                {% endif %}
                {% if is_final_feedback %}
                    <div class="final-feedback-actions">
                        <a href="{{ url_for('results') }}" class="button">Continue to Results</a>
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
{% if mode == 'exam' %}
<script>
    // Add timer JavaScript here
    function updateTimer() {
        const startTime = new Date("{{ session.start_time }}");
        const timeLimit = {{ session.total_exam_time }};
        const now = new Date();
        const timeElapsed = Math.floor((now - startTime) / 1000);
        const timeRemaining = timeLimit - timeElapsed;
        
        if (timeRemaining <= 0) {
            window.location.href = "{{ url_for('results') }}";
        }
        
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        document.getElementById('timer').textContent = 
            `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    setInterval(updateTimer, 1000);
    updateTimer();
</script>
{% endif %}
{% endblock %}
